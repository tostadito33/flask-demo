{% extends "base.html" %}
{% block content %}

<h1 class="mb-4">Listado de pel√≠culas</h1>

<!-- Formulario GET de b√∫squeda / filtro -->
<form class="row g-3 mb-4" method="get" action="{{ url_for('index') }}">
  <div class="col-md-5">
    <input type="text" class="form-control" name="q" placeholder="Buscar por t√≠tulo"
           value="{{ q }}">
  </div>
  <div class="col-md-5">
    <input type="text" class="form-control" name="genre" placeholder="Filtrar por g√©nero"
           value="{{ genre_filter }}">
  </div>
  <div class="col-md-2 d-grid">
    <button type="submit" class="btn btn-primary">Buscar</button>
  </div>
</form>

<div class="mb-4">
  <a href="{{ url_for('add_movie') }}" class="btn btn-success">‚ûï A√±adir nueva pel√≠cula</a>
</div>

<!-- Recomendaci√≥n ‚Äúinteligente‚Äù -->
{% if recommendation %}
<div class="card mb-4">
  <div class="card-header">
    Recomendaci√≥n inteligente üéØ
  </div>
  <div class="card-body">
    <p class="card-text">
      Te recomendamos ver <strong>{{ recommendation.title }}</strong>
      (g√©nero: {{ recommendation.genre }}) porque es de las mejor valoradas.
    </p>
  </div>
</div>
{% endif %}

<!-- Tabla de pel√≠culas -->
{% if movies %}
<table class="table table-striped">
  <thead>
    <tr>
      <th>T√≠tulo</th>
      <th>G√©nero</th>
      <th>Puntuaci√≥n</th>
      <th>A√±adida por</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody>
  {% for movie in movies %}
    <tr>
      <td>{{ movie.title }}</td>
      <td>{{ movie.genre }}</td>
      <td>{{ movie.rating }}</td>
      <td>{{ movie.added_by or "-" }}</td>
      <td>
        <form action="{{ url_for('delete_movie', movie_id=movie.id) }}"
              method="POST"
              onsubmit="return confirm('¬øSeguro que quieres borrar esta pel√≠cula?');">
          <button type="submit" class="btn btn-danger btn-sm">Borrar</button>
        </form>
      </td>
    </tr>
  {% endfor %}
  </tbody>
</table>
{% else %}
<p>No hay pel√≠culas todav√≠a. ¬°A√±ade la primera!</p>
{% endif %}

{% endblock %}
